# CG思考题

**1950679**

**孟繁青**

**思考过程基本未参考任何资料**

## 象限法的问题与改进（单位圆法）

该方法的本质是做一个半径比较小的单位圆，然后将边投影到单位圆上，通过观察弧长（实际上是观察角度）来确定点的位置。

如下所示：

![image-20211002093223082](/Users/fanqing_m/Library/Application Support/typora-user-images/image-20211002093223082.png)

但是算角度或者说算弧长比较浪费时间，我们采用了跨越象限的方法来进行计算

以需要判断的点p为坐标原点，按逆时针顺序判断多边形的点的象限变化，进行角度的加减，如下所示：

<img src="/Users/fanqing_m/Library/Application Support/typora-user-images/image-20211002093508726.png" alt="image-20211002093508726" style="zoom:50%;" />

### 优化：

所以在弧长法中，我们首先可以很自然的提出一种优化：

**即我们这里避免浮点数的运算，将Pi/2认为1，将Pi认为2，进行整数的加减。**	

### 解决问题：

所以在弧长法中，我们首先需要解决两个问题

- 多边形上的点在坐标轴上
- 需要判断的点在多边形的边上
- 需要判断的点在多边形的顶点上

### 解决需要判断的点在多边形的顶点上的情况

进行一轮预先判断即可。

### 解决需要判断的点在多边形的边上的情况

我们不需要先进行预处理，看看在不在边上，我们不需要改变原有算法的计算流程，只需要在出现对角象限的点（P1，P2）时，判断一下O（P）P1和O（P）P2的斜率是否相等即可。如果相等说明在多边形的边上。

### 解决多边形上的点在坐标轴上

如图所示，我们规定坐标轴也算在象限里面

- 对于第一象限，其包括x的正半轴
- 对于第二象限，其包括y的正半轴
- 对于第三象限，其包括x的负半轴
- 对于第四象限，其包括y的负半轴

<img src="/Users/fanqing_m/Library/Application Support/typora-user-images/image-20211002094836780.png" alt="image-20211002094836780" style="zoom:50%;" />





## 射线法判断点是否在三维体的内部

我们尝试将二维的射线法推广到三维，注意到我们在二维情况下判断射线是否与线段相交仅仅使用到了几个比较语句而不需要进行任何的乘法除法或者浮点数运算。则我们首先需要进行推广的就是如何计算射线与有界平面是否相交，并尽可能的不用乘除法或者浮点数运算。

**我们假设我们这里三维物体的表示，是告诉我们了三维物体所有面的信息，即哪几个点构成了一个面，以及这几个点的坐标**

**我们的坐标系默认是下图所示的坐标系**

**我们设我们需要判断点p在平面A的“内还是外”**

### 判断射线是否与平面相交

我们假设我们这里的射线都是由需要判断的点P出发，垂直于XOZ平面，方向指向y轴正半轴

<img src="/Users/fanqing_m/Library/Application Support/typora-user-images/image-20211002100850635.png" alt="image-20211002100850635" style="zoom:33%;" />

**首先我们判断直线是否与平面相交**

我们转而判断平面与直线是否平行，实际上就是**判断平面与y轴是否平行**

这里我们可以求平面的法向量，之后如果法向量的y分量为0，则说明直线与平面平行，否则相交

**PS：这里我觉得也是有不需要计算法向量的做法的，因为我们这里需要判断的直线（就是y轴）很特殊，可能仅仅通过一些简单的运算就可以潘丹出来，但是我暂时还没有想到一种好的方法**



**其次我们判断射线与平面是否相交**

如果该射线所在直线与平面平行，那么我们实际上不需要进行这一步骤

否则，我认为有如下算法，**该算法是基于高维图形的投影进而化归到低维图形的处理场景**

首先我们考虑最简单的情况，

- 平面A的三个端点的坐标的y分量都小于Yp，那么平面A显然不可能与射线P有交点。
- 平面A的三个端点的坐标的y分量都大于Yp，那么平面A显然与射线P有交点。

然后我们讨论较为复杂的情况

我们观察一下几副图

![image-20211002104109894](/Users/fanqing_m/Library/Application Support/typora-user-images/image-20211002104109894.png)

- 当只有平面A只有一个端点的坐标的y分量大于Yp时，根据左图我们不难发现，其有可能出现有交点也有可能出现没有交点的情况，我们将其投影到YOZ平面，可能有下图的情况

  <img src="/Users/fanqing_m/Library/Application Support/typora-user-images/image-20211002105359210.png" alt="image-20211002105359210" style="zoom:50%;" />

  

可以发现啊，**我们本质上只需要判断点和一条线段的位置关系就可以了**

**需要注意我们的P如果在线段的上方或者下方，那也不会出现交点**

这个点当然是我们需要判断点P点，线段是平面A的三个端点中y坐标分量最大的两个，**判断的过程是二维空间下射线法判断点是否在多边形内部的操作方式**

- 当只有平面A只有两个端点的坐标的y分量大于Yp时，根据右图我们不难发现，其有可能出现有交点也有可能出现没有交点的情况，我们将其投影到YOZ平面，可能有下图的情况

  <img src="/Users/fanqing_m/Library/Application Support/typora-user-images/image-20211002105939421.png" alt="image-20211002105939421" style="zoom:50%;" />

  **可以发现，我们本质上还是需要判断点与线段的位置关系**

  这个点当然是我们需要判断点P点，线段是平面A的三个端点中y坐标分量最大和最小的两个，**判断的过程是二维空间下射线法判断点是否在多边形内部的操作方式**



### 在投影到YOZ之前

**特别需要指出的是**，上述我们**投影到YOZ平面，是忽略了x坐标分量**，所以可能导致点与有界平面发生了在x轴分量上的位置错位，导致上述判断产生错误结果。

所以**我们在投影到YOZ平面之前，还需要先投影到XOZ平面**，在按照上述算法判断一下点在线段的内还是外部。

如果是外部就没有交点，直接进行到下一平面与点位置关系的判读

否则在进行投影到YOZ平面进行上述算法。



通过以上算法，其实已经完成了射线法判断点是否在多面体内部的主体方法，即我们对点P以及我们多面体的每一个面执行上述算法，最终判断交点数，如果交点数是奇数，那么说明点在多面体的内部；否则在外部。



### 特殊情况判断

我们下面类似于二维空间下射线法出现的异常情况，讨论三维空间的异常情况

#### 点在多面体顶点

预先判断一下就行了，比较容易

#### 点在多面体的面上（没想到好办法）

**没想到太好办法**，可能我们注意到射线与平面的交点的坐标，其x，z坐标分量都与P是一样的，那么我们通过某些坐标换算（或者求平面方程）找到这交点对应的y分量与P进行比较即可。

#### 射线是否与平面相切

这个实际在我们的算法中不会对计算交点数造成影响，应为我们的射线平行y轴，这样的话平面就平行y轴，那么法向量就垂直y轴了，在我们的计算过程中如果出现这种情况，我们就不会继续针对点与这个平面算了，所以没有出现交点数。

#### 射线穿过多面体顶点

我们回想一下在二维空间中是如何解决这一情况的

顶点穿越看似棘手，其实我们换一个角度，思路会大不相同。先来回答一个问题，射线穿越一条线段需要什么前提条件？没错，就是线段两个端点分别在射线两侧。只要想通这一点，顶点穿越就迎刃而解了。这样一来，我们只需要规定被射线穿越的点都算作上侧。

<img src="https://img-blog.csdn.net/20161030200907079" alt="img" style="zoom:75%;" />

**简单思考一下，发现这种方法似乎很难推广到三维情况，因为一个点可能在许多个面的上面，我们无论认为这条射线穿过的顶点时在线的上方还是下方，都会造成误判。**

**暂时没想到一种好的办法判断，可能我们可以不考虑这种情况，即都认为在里面，这样只会有一点点的误差。**

